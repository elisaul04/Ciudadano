<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <header>
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Bienvenido!!!</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link" href="" onclick="getSectionToDisplay('hola')">Registrar Problematica
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="">Casos Resueltos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="">Contactos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="">Login</a>
            </li>
          </ul>
        </div>
      </nav>

      <container>
        <div class="row">
          <table class="table table-striped">
            <thead>
              <th>Usuario</th>
              <th>Titulo</th>
              <th>Ubicación</th>
              <th>Fecha</th>
              <th>Evidencia</th>
            </thead>
            <tbody id="tblCasos">
            </tbody>
          </table>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <label for="titulo">Titulo</label>
            <input type="text" id="txtTitulo" class="form-control">
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-12">
            <label for="comment">Commentario</label>
            <textarea class="form-control" rows="2" id="txtComentario"></textarea>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-3">
            <label>Tipo </label>
            <select class="form-control"></select>
          </div>
          <div class="form-group col-md-3">
            <label>Latitud </label>
            <input type="text" id="txtLatitud" class="form-control">
          </div>
          <div class="form-group col-md-3">
            <label>Longitud </label>
            <input type="text" id="txtLongitud" class="form-control">
          </div>
          <div class="form-group col-md-3">
            <label for="inputFile">Cargar Evidencia</label>
            <input type="file" class="form-control-file" id="evidencia">
          </div>
        </div>
        <div class="row">
          <div id="map" style="width:100%; height: 400px;"></div>
        </div>

        <p>
          <input type="button" value="Registrar" onclick="InsertCaso()" style="margin-top: 10px" class="btn btn-success">
        </p>

        <div class="row">
          <div class="form-control ">
            <label>Titulo</label>
            <input type="text" id="txtTituloMensaje" class="form-control">
            <label for="txtDescripcion">Descripción</label>
            <textarea class="form-control" rows="3" id="txtDescripcionMensaje"></textarea>
            <p>
              <input type="button" value="Enviar" onclick="EnviarMensaje()" style="margin-top: 10px" class="btn btn-success">
            </p>
          </div>
        </div>
        <div class="row">
          <table class="table table-striped">
            <thead>
              <th>Titulo</th>
              <th>Fecha</th>
              <th>Descripción</th>              
            </thead>
            <tbody id="tblMensajes">
            </tbody>
          </table>
        </div>
        <div style="height: 100px;width:250px">
          <canvas id="grafica"></canvas>
        </div>
      </container>
    </div>
</body>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMc06HQwXKYGd9HQ6lAbS96vNggKACxKE&callback=myMap"></script>
<script src="https://www.gstatic.com/firebasejs/5.3.0/firebase.js"></script>

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
<script src="index.js"></script>
<script>



  function successFunction(position) {
    var lat = position.coords.latitude;
    var long = position.coords.longitude;
    myMap(lat, long)
  }
  function errorFunction(position) {
    alert('Error!');
  }
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(successFunction, errorFunction);
  }
  function myMap(lat, long) {

    var markers = [];
    var myLocation = { lat: lat, lng: long };

    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 13,
      center: myLocation
    });
    addMarker(myLocation)
    //showMarkers();

    function addMarker(location) {
      var marker = new google.maps.Marker({
        position: location,
        map: map
      });
      markers.push(marker);
    }

    function setMapOnAll(map) {
      for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(map);

      }
    }

    function clearMarkers() {
      setMapOnAll(null);
    }
    function deleteMarkers() {
      clearMarkers();
      markers = [];
    }
    function showMarkers() {
      setMapOnAll(map);
    }

    google.maps.event.addListener(map, "click", function (e) {
      document.getElementById("txtLatitud").value = e.latLng.lat();
      document.getElementById("txtLongitud").value = e.latLng.lng();
      let newLocation = { lat: e.latLng.lat(), lng: e.latLng.lng() };
      clearMarkers();
      addMarker(newLocation)
    });

    CargarMarkers = function () {
      var query = firebase.database().ref("Casos").limitToFirst(20);
      query.once("value")
        .then(function (snapshot) {
          snapshot.forEach(function (item) {
            var location = {
              lat: parseFloat(item.val().Latitud),
              lng: parseFloat(item.val().Longitud)
            };
            // alert(JSON.stringify(location))
            addMarker(location)

          });
          showMarkers();
        })
    }
    CargarMarkers();

  }
</script>

</html>
<script src="firebase.js"></script>
<script src="caso.js"></script>
<script src="contacto.js"></script>
<script src="admin.js"></script>